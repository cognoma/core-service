machine:
    python:
        version: 3.5.1
    environment:
        DB_NAME: circle_test
        DB_USER: ubuntu
        DB_HOST: 127.0.0.1
    services:
        - postgresql
        - docker

    dependencies:
        post:
            - docker build -t $AWS_ACCOUNT_ID.dkr.ecr.us-east-1.amazonaws.com/cognoma-core-service:$CIRCLE_SHA1 .

    deployment:
        prod:
            branch: master
            commands:
                - ./ecr_push.sh
                - ./ecs_deploy.sh -c $AWS_CLUSTER_NAME -i $AWS_ECR_ENDPOINT.dkr.ecr.us-east-1.amazonaws.com/cognoma-core-service:$CIRCLE_SHA1